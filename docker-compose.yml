services:      
  rails:
    container_name: rails
    image: skills-dev/rails
    user: "${UID:-1000}"
    tty: true
    stdin_open: true
    env_file: .env
    build:
      context: ./config/docker/development
      dockerfile: Rails.dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ./:/myapp
      - ./tmp/seed:/seed
      - ./config/docker/development/home/rails:/home/developer
      - /tmp/.X11-unix:/tmp/.X11-unix
      - bundler_cache:/opt/bundle
    depends_on:
      - postgres-rails
      - keycloak

      
  keycloak:
    container_name: keycloak
    image: quay.io/keycloak/keycloak:23.0.7
    env_file: keycloak.env
    environment:
      - PORT=8080
    ports:
      - "8080:8080"
    command:
      - start-dev
      - --import-realm
      - --http-relative-path=/auth
    volumes:
      - ${PWD}/realm-skills.json:/opt/keycloak/data/import/realm.json

  postgres-rails:
    container_name: postgres-rails
    image: postgres:16
    ports:
      - 5432:5432
    environment:
      - POSTGRES_DB=skills_development
      - POSTGRES_USER=skills
      - POSTGRES_PASSWORD=skills
    volumes:
      - postgres_rails:/var/lib/postgres

volumes:
  bundler_cache:
  postgres_rails:

